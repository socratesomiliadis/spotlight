import Link from "next/link";
import { auth } from "@clerk/nextjs/server";
import UserBtn from "./user-button";
import AuthDrawer from "../auth-drawer";
import { UserButton } from "@clerk/nextjs";
import CustomButton from "../custom-button";
import { createClient } from "@/lib/supabase/server";

async function getAvatarUrl(userId: string) {
  const supabase = await createClient();
  const { data, error } = await supabase
    .from("profile")
    .select("avatar_url")
    .eq("user_id", userId)
    .single();

  if (error) {
    console.log(error);
    return null;
  }

  return data?.avatar_url;
}

export default async function Header() {
  const { userId } = await auth();

  let avatarUrl;

  if (userId) {
    avatarUrl = await getAvatarUrl(userId);
  }

  return (
    <header className="w-screen absolute top-6 px-[22vw] flex flex-row items-center justify-between z-50">
      <Link href="/" className="w-32 header-logo flex items-center text-black">
        <svg
          width="100%"
          viewBox="0 0 560 134"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M33.6048 108.717C12.6842 108.717 1.13714 98.142 0.59375 81.7373H18.254C18.6615 91.0921 24.6389 95.1594 33.469 95.1594C42.7067 95.1594 47.733 90.8209 47.733 84.1777C47.733 78.3479 44.0651 74.823 34.8275 74.823H26.6766C11.0541 74.823 1.95223 66.2817 1.95223 53.6731C1.95223 39.4376 13.4993 29.5406 33.0614 29.5406C53.167 29.5406 64.1707 40.1155 64.7141 55.9779H47.1897C46.7821 47.5722 42.1633 43.0982 33.0614 43.0982C24.9106 43.0982 19.8842 46.8943 19.8842 52.9952C19.8842 58.5538 24.0955 61.2654 31.0237 61.2654H39.9897C57.9217 61.2654 66.0725 71.298 66.0725 83.4998C66.0725 98.2776 54.3896 108.717 33.6048 108.717Z"
            fill="currentColor"
          />
          <path
            d="M73.6981 133.527V31.8454H90.6791V37.2684C90.6791 39.9799 90.6791 42.2847 90.5432 44.8607H90.8149C95.2979 35.3704 104.4 29.5406 115.811 29.5406C133.2 29.5406 149.094 43.2338 149.094 69.1288C149.094 95.0238 133.2 108.717 115.811 108.717C104.4 108.717 95.2979 102.887 90.8149 93.3969H90.5432C90.6791 96.244 90.6791 98.6843 90.6791 101.396V133.527H73.6981ZM90.6791 69.1288C90.6791 84.8556 98.1507 95.1594 110.649 95.1594C123.283 95.1594 130.754 84.8556 130.754 69.1288C130.754 53.402 123.283 43.0982 110.649 43.0982C98.1507 43.0982 90.6791 53.402 90.6791 69.1288Z"
            fill="currentColor"
          />
          <path
            d="M191.253 108.717C170.197 108.717 153.352 94.6171 153.352 69.1288C153.352 43.6405 170.197 29.5406 191.253 29.5406C212.31 29.5406 229.155 43.6405 229.155 69.1288C229.155 94.6171 212.31 108.717 191.253 108.717ZM171.691 69.1288C171.691 86.3469 179.435 95.1594 191.253 95.1594C203.072 95.1594 210.816 86.3469 210.816 69.1288C210.816 51.9106 203.072 43.0982 191.253 43.0982C179.435 43.0982 171.691 51.9106 171.691 69.1288Z"
            fill="currentColor"
          />
          <path
            d="M262.818 106.412C249.505 106.412 242.441 99.7689 242.441 86.2113V45.8097H228.041V31.8454H242.441V11.509H259.693V31.8454H282.244V45.8097H259.693V83.6354C259.693 90.0075 262.954 92.4478 268.659 92.4478H282.652V106.412H262.818Z"
            fill="currentColor"
          />
          <path
            d="M288.858 106.412V0.527344H305.975V106.412H288.858Z"
            fill="currentColor"
          />
          <path
            d="M318.612 106.412V31.8454H335.729V106.412H318.612ZM318.34 20.0503V3.51001H335.865V20.0503H318.34Z"
            fill="currentColor"
          />
          <path
            d="M363.613 133.527C348.67 133.527 341.605 126.613 341.605 117.394C341.605 110.208 345.817 104.379 354.239 102.48V102.209C348.805 100.04 345.273 95.5661 345.273 89.4652C345.273 82.4152 350.164 77.8056 356.413 76.9922L358.179 76.721V76.4499C349.62 72.9249 344.322 65.3326 344.322 55.1644C344.322 38.7598 358.315 29.5406 374.888 29.5406C385.756 29.5406 395.401 33.7434 400.835 40.929H401.107C401.379 35.2348 404.775 31.8454 410.345 31.8454H413.741V45.8097H408.443C405.997 45.8097 404.911 46.6232 404.639 48.6568C405.182 50.6904 405.454 52.8597 405.454 55.1644C405.454 71.1624 392.277 80.9239 375.432 80.9239H366.873C362.798 80.9239 360.217 82.2796 360.217 85.669C360.217 88.7873 362.526 90.5498 366.873 90.5498H389.831C405.454 90.5498 414.556 98.8199 414.556 111.971C414.556 125.122 405.454 133.527 389.831 133.527H363.613ZM356.141 112.784C356.141 117.936 359.402 121.461 366.601 121.461H387.25C393.907 121.461 397.711 118.207 397.711 112.784C397.711 107.226 393.907 104.107 387.25 104.107H366.601C359.673 104.107 356.141 107.497 356.141 112.784ZM360.624 55.9779C360.624 64.7903 367.145 68.8576 374.888 68.8576C382.632 68.8576 389.152 64.7903 389.152 55.9779C389.152 47.1655 382.632 43.0982 374.888 43.0982C367.145 43.0982 360.624 47.1655 360.624 55.9779Z"
            fill="currentColor"
          />
          <path
            d="M419.909 106.412V0.527344H437.026V30.8964C437.026 34.2858 437.026 36.8617 436.754 43.2338H437.026C440.966 35.0992 448.709 29.5406 459.441 29.5406C474.792 29.5406 485.252 40.1155 485.252 58.2827V106.412H468.135V61.6721C468.135 48.3857 462.43 43.2338 454.007 43.2338C445.177 43.2338 437.026 48.7924 437.026 63.7057V106.412H419.909Z"
            fill="currentColor"
          />
          <path
            d="M522.76 106.412C509.447 106.412 502.383 99.7689 502.383 86.2113V45.8097H487.983V31.8454H502.383V11.509H519.635V31.8454H542.186V45.8097H519.635V83.6354C519.635 90.0075 522.896 92.4478 528.601 92.4478H542.594V106.412H522.76Z"
            fill="currentColor"
          />
        </svg>
      </Link>
      <div className="flex flex-row items-center gap-2">
        {userId && (
          <>
            <UserBtn avatarUrl={avatarUrl || ""} />
            {/* <UserButton /> */}
            <CustomButton text="Premium" href="/premium" />
          </>
        )}
        <AuthDrawer userExists={!!userId} />
        <CustomButton text="Submit" href="/submit" inverted />
      </div>
    </header>
  );
}
